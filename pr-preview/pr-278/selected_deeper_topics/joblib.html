<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="7. Overview of available Pipeline Steps" href="../available_pipeline_steps.html" /><link rel="prev" title="6.7. Connectome-based Predictive Modeling (CBPM)" href="CBPM.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>6.8. Parallelizing julearn with Joblib - julearn documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=38fa36eb" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">julearn  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/julearn_logo_it.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">julearn  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">1. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html#setup-suggestion">2. Setup suggestion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html#installing">3. Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html#optional-dependencies">4. Optional Dependencies</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../what_really_need_know/index.html">5. What you really need to know</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 5. What you really need to know</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../what_really_need_know/cross_validation.html">5.1. Why cross validation?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../what_really_need_know/data.html">5.2. Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../what_really_need_know/pipeline.html">5.3. Model Building</a></li>
<li class="toctree-l2"><a class="reference internal" href="../what_really_need_know/model_evaluation.html">5.4. Model Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../what_really_need_know/model_comparison.html">5.5. Model Comparison</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">6. Selected deeper topics</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 6. Selected deeper topics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="target_transformers.html">6.1. Applying preprocessing to the target</a></li>
<li class="toctree-l2"><a class="reference internal" href="confound_removal.html">6.2. Cross-validation consistent Confound Removal</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyperparameter_tuning.html">6.3. Hyperparameter Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_inspect.html">6.4. Inspecting Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="cross_validation_splitter.html">6.5. Cross-validation splitters</a></li>
<li class="toctree-l2"><a class="reference internal" href="stacked_models.html">6.6. Stacking Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="CBPM.html">6.7. Connectome-based Predictive Modeling (CBPM)</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">6.8. Parallelizing julearn with Joblib</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../available_pipeline_steps.html">7. Overview of available Pipeline Steps</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples.html">8. Examples</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 8. Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/00_starting/index.html">8.1. Starting with <code class="docutils literal notranslate"><span class="pre">julearn</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 8.1. Starting with julearn</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_starting/run_combine_pandas.html">Working with <code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_starting/run_simple_binary_classification.html">Simple Binary Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_starting/run_grouped_cv.html">Grouped CV</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_starting/plot_cm_acc_multiclass.html">Multiclass Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_starting/plot_stratified_kfold_reg.html">Stratified K-fold CV for regression analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_starting/plot_example_regression.html">Regression Analysis</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/01_model_comparison/index.html">8.2. Model Comparison</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 8.2. Model Comparison</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/01_model_comparison/plot_simple_model_comparison.html">Simple Model Comparison</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/02_inspection/index.html">8.3. Inspection</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 8.3. Inspection</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/02_inspection/run_binary_inspect_folds.html">Inspecting the fold-wise predictions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/02_inspection/plot_inspect_random_forest.html">Inspecting Random Forest models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/02_inspection/plot_groupcv_inspect_svm.html">Inspecting SVM models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/02_inspection/plot_preprocess.html">Preprocessing with variance threshold, zscore and PCA</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/03_complex_models/index.html">8.4. Complex Models</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 8.4. Complex Models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/03_complex_models/run_apply_to_target.html">Transforming target variable with z-score</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/03_complex_models/run_hyperparameter_tuning_bayessearch.html">Tuning Hyperparameters using Bayesian Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/03_complex_models/run_hyperparameter_multiple_grids.html">Tuning Multiple Hyperparameters Grids</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/03_complex_models/run_stacked_models.html">Stacking Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/03_complex_models/run_hyperparameter_tuning.html">Tuning Hyperparameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/03_complex_models/run_example_pca_featsets.html">Regression Analysis</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/04_confounds/index.html">8.5. Confounds</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of 8.5. Confounds</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/04_confounds/run_return_confounds.html">Return Confounds in Confound Removal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/04_confounds/plot_confound_removal_classification.html">Confound Removal (model comparison)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/05_customization/index.html">8.6. Customization</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 8.6. Customization</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/05_customization/run_custom_scorers_regression.html">Custom Scoring Function for Regression</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">9. API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 9. API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/main.html">9.1. Main API</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of 9.1. Main API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.run_cross_validation.html">julearn.run_cross_validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.run_fit.html">julearn.run_fit</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/pipeline.html">9.2. Pipeline</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of 9.2. Pipeline</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.PipelineCreator.html">julearn.PipelineCreator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.TargetPipelineCreator.html">julearn.TargetPipelineCreator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.pipeline.JuTargetPipeline.html">julearn.pipeline.JuTargetPipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.pipeline.pipeline_creator.Step.html">julearn.pipeline.pipeline_creator.Step</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/model_selection.html">9.3. Model Selection</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of 9.3. Model Selection</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.model_selection.ContinuousStratifiedKFold.html">julearn.model_selection.ContinuousStratifiedKFold</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.model_selection.RepeatedContinuousStratifiedKFold.html">julearn.model_selection.RepeatedContinuousStratifiedKFold</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.model_selection.ContinuousStratifiedGroupKFold.html">julearn.model_selection.ContinuousStratifiedGroupKFold</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.model_selection.RepeatedContinuousStratifiedGroupKFold.html">julearn.model_selection.RepeatedContinuousStratifiedGroupKFold</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.model_selection.StratifiedBootstrap.html">julearn.model_selection.StratifiedBootstrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.model_selection.get_searcher.html">julearn.model_selection.get_searcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.model_selection.list_searchers.html">julearn.model_selection.list_searchers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.model_selection.register_searcher.html">julearn.model_selection.register_searcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.model_selection.reset_searcher_register.html">julearn.model_selection.reset_searcher_register</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/base.html">9.4. Base</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of 9.4. Base</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.base.JuBaseEstimator.html">julearn.base.JuBaseEstimator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.base.JuTransformer.html">julearn.base.JuTransformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.base.WrapModel.html">julearn.base.WrapModel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.base.ColumnTypes.html">julearn.base.ColumnTypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.base.ColumnTypesLike.html">julearn.base.ColumnTypesLike</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.base.change_column_type.html">julearn.base.change_column_type</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.base.get_column_type.html">julearn.base.get_column_type</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.base.make_type_selector.html">julearn.base.make_type_selector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.base.ensure_column_types.html">julearn.base.ensure_column_types</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/inspect.html">9.5. Inspect</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of 9.5. Inspect</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.inspect.Inspector.html">julearn.inspect.Inspector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.inspect.FoldsInspector.html">julearn.inspect.FoldsInspector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.inspect.preprocess.html">julearn.inspect.preprocess</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/models.html">9.6. Models</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of 9.6. Models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.models.list_models.html">julearn.models.list_models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.models.get_model.html">julearn.models.get_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.models.register_model.html">julearn.models.register_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.models.reset_model_register.html">julearn.models.reset_model_register</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/models.html#dynamic-selection-deslib">9.7. Dynamic Selection (DESLib)</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of 9.7. Dynamic Selection (DESLib)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.models.dynamic.DynamicSelection.html">julearn.models.dynamic.DynamicSelection</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/scoring.html">9.8. Scoring</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of 9.8. Scoring</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.scoring.get_scorer.html">julearn.scoring.get_scorer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.scoring.list_scorers.html">julearn.scoring.list_scorers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.scoring.register_scorer.html">julearn.scoring.register_scorer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.scoring.reset_scorer_register.html">julearn.scoring.reset_scorer_register</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.scoring.check_scoring.html">julearn.scoring.check_scoring</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/scoring.html#module-julearn.scoring.metrics">9.9. Scoring Metrics</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 9.9. Scoring Metrics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.scoring.metrics.r_corr.html">julearn.scoring.metrics.r_corr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.scoring.metrics.r2_corr.html">julearn.scoring.metrics.r2_corr</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/transformers.html">9.10. Transformers</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 9.10. Transformers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.DropColumns.html">julearn.transformers.DropColumns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.ChangeColumnTypes.html">julearn.transformers.ChangeColumnTypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.SetColumnTypes.html">julearn.transformers.SetColumnTypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.FilterColumns.html">julearn.transformers.FilterColumns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.CBPM.html">julearn.transformers.CBPM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.JuColumnTransformer.html">julearn.transformers.JuColumnTransformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.confound_remover.ConfoundRemover.html">julearn.transformers.confound_remover.ConfoundRemover</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.list_transformers.html">julearn.transformers.list_transformers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.get_transformer.html">julearn.transformers.get_transformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.register_transformer.html">julearn.transformers.register_transformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.reset_transformer_register.html">julearn.transformers.reset_transformer_register</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/transformers.html#module-julearn.transformers.target">9.11. Target Transformers</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of 9.11. Target Transformers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.target.JuTransformedTargetModel.html">julearn.transformers.target.JuTransformedTargetModel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.target.JuTargetTransformer.html">julearn.transformers.target.JuTargetTransformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.target.TargetConfoundRemover.html">julearn.transformers.target.TargetConfoundRemover</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.target.TransformedTargetWarning.html">julearn.transformers.target.TransformedTargetWarning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.target.get_target_transformer.html">julearn.transformers.target.get_target_transformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.target.list_target_transformers.html">julearn.transformers.target.list_target_transformers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.target.register_target_transformer.html">julearn.transformers.target.register_target_transformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.transformers.target.reset_target_transformer_register.html">julearn.transformers.target.reset_target_transformer_register</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/utils.html">9.12. Utils</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of 9.12. Utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.utils.logger.html">julearn.utils.logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.utils.configure_logging.html">julearn.utils.configure_logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.utils.raise_error.html">julearn.utils.raise_error</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.utils.warn_with_log.html">julearn.utils.warn_with_log</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/utils.html#module-julearn.utils.typing">9.13. Typing</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of 9.13. Typing</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.utils.typing.JuEstimatorLike.html">julearn.utils.typing.JuEstimatorLike</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.utils.typing.EstimatorLike.html">julearn.utils.typing.EstimatorLike</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.utils.typing.EstimatorLikeFit1.html">julearn.utils.typing.EstimatorLikeFit1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.utils.typing.EstimatorLikeFit2.html">julearn.utils.typing.EstimatorLikeFit2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.utils.typing.EstimatorLikeFity.html">julearn.utils.typing.EstimatorLikeFity</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/prepare.html">9.14. Prepare</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of 9.14. Prepare</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.prepare.prepare_input_data.html">julearn.prepare.prepare_input_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.prepare.check_consistency.html">julearn.prepare.check_consistency</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/stats.html">9.15. Stats</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of 9.15. Stats</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.stats.corrected_ttest.html">julearn.stats.corrected_ttest</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/viz.html">9.16. Visualization</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of 9.16. Visualization</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.viz.plot_scores.html">julearn.viz.plot_scores</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/config.html">9.17. Config</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle navigation of 9.17. Config</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.config.set_config.html">julearn.config.set_config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/julearn.config.get_config.html">julearn.config.get_config</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">10. Configuring <code class="docutils literal notranslate"><span class="pre">julearn</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">11. Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintaining.html">12. Maintaining</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">13. FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">14. What’s new</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="parallelizing-julearn-with-joblib">
<span id="joblib-parallel"></span><h1><span class="section-number">6.8. </span>Parallelizing julearn with Joblib<a class="headerlink" href="#parallelizing-julearn-with-joblib" title="Link to this heading">#</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure you are using the latest version of <code class="docutils literal notranslate"><span class="pre">julearn</span></code>, as we are
actively developing and fine-tuning these packages to improve performance.
Older versions of <code class="docutils literal notranslate"><span class="pre">julearn</span></code> might have a huge computational impact when used
with joblib.</p>
</div>
<p>As with <a class="reference external" href="https://scikit-learn.org/stable/">scikit-learn</a>, <code class="docutils literal notranslate"><span class="pre">julearn</span></code> allows you to parallelize your code using
<a class="reference external" href="https://joblib.readthedocs.io/en/stable/">Joblib</a>. This can be particularly useful when you have a large dataset or
when you are running a computationally expensive operation that can be easily
computed in parallel.</p>
<p>Without going into details about parallel and distributed computing, the idea
is to split the computation into smaller tasks that can be executed
independently from each other. This way, you can take advantage of multiple
<em>processors</em> to do them in parallel. A very clear example of this situation is
when you are estimating a model’s performance using cross-validation. In this
case, you can parallelize the computation of the different folds, as the
training and testing of each fold are independent from the other folds.</p>
<p>Mostly all modern computers have multiple processors or <em>cores</em>, which allows
to run multiple tasks at the same time.  If you are familiar, you might
have noticed that scikit-learn already has a parallelization mechanism using
the <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code> parameter. <code class="docutils literal notranslate"><span class="pre">julearn</span></code> is actually using scikit-learn, so it is
possible to use the <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code> parameter. If you want to read more about how
scikit-learn parallelizes its code, you can check the section
<a class="reference external" href="https://scikit-learn.org/stable/computing/parallelism.html#parallelism" title="(in scikit-learn v1.5)"><span>Parallelism</span></a> on scikit-learn’s documentation.</p>
<p>In short, the <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code> parameter in scikit-learn allows you to specify the
number of jobs to run in parallel. If you set it to <code class="docutils literal notranslate"><span class="pre">-1</span></code>, it will use all the
processors available, which is usually the best option for most cases.</p>
<p>One of the explicit ways to control parallelization in scikit-learn and
<code class="docutils literal notranslate"><span class="pre">julearn</span></code> is to use a joblib’s
<a class="reference external" href="https://joblib.readthedocs.io/en/latest/generated/joblib.parallel_config.html#joblib.parallel_config" title="(in joblib v1.5.dev0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">parallel_config</span></code></a> context manager. The following
snippet will run the code in parallel using the <code class="docutils literal notranslate"><span class="pre">&quot;loky&quot;</span></code> backend
with 4 processors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">parallel_config</span>

<span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">parallel_config</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s2">&quot;loky&quot;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">X_types</span><span class="o">=</span><span class="n">X_types</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
        <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Importantly, this sets the number of parallel processes that joblib dispatches
but does not set the number of threads (i.e. another low-level parallelization
mechanism) that each process uses. The <code class="docutils literal notranslate"><span class="pre">&quot;loky&quot;</span></code> backend is quite intelligent,
but can’t always determine the optimal number of threads to use if you don’t
want to use 100% of the resources. You can set the number of threads per
process by setting the <code class="docutils literal notranslate"><span class="pre">inner_max_num_threads</span></code> parameter in the context
manager. For example, to make sure that only 4 processors are used and each
process uses only 1 thread, you can do the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">parallel_config</span>

<span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">parallel_config</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s2">&quot;loky&quot;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">inner_max_num_threads</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">X_types</span><span class="o">=</span><span class="n">X_types</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
        <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<section id="massively-parallelizing-julearn-with-joblib-and-htcondor">
<h2>Massively parallelizing <code class="docutils literal notranslate"><span class="pre">julearn</span></code> with Joblib and HTcondor<a class="headerlink" href="#massively-parallelizing-julearn-with-joblib-and-htcondor" title="Link to this heading">#</a></h2>
<p>Sometimes even with multiple processors, the computation can take a long time.
As an example, assuming a model that takes 1 hour to fit, a 5 times 5-fold
cross-validation takes 25 hours of computation. If you add a grid search to
find the best hyperparameter using another 5-fold CV, and this grid has
10 hyperparameters sets to test, this adds another 1250 hours of computation.
This is a total of 1275 hours. In technical terms, this are 1275 core-hours,
which is a unit of processing time in a single core. With 4 processors, this is
318 hours, which is almost 13 days of computation.
If the model takes 10 hours to fit, this goes to 12750 core-hours, which is
almost 4.5 months with 4 processors.</p>
<p>As you can see in the following table, sometimes we might need to use
hundreds of processors to obtain results within reasonable time spans.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-center">
<thead>
<tr class="row-odd"><th class="head"><p>Total core-hours</p></th>
<th class="head"><p>Number of processors</p></th>
<th class="head"><p>Time (approx.)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1250</p></td>
<td><p>1</p></td>
<td><p>52 days</p></td>
</tr>
<tr class="row-odd"><td><p>1250</p></td>
<td><p>4</p></td>
<td><p>13 days</p></td>
</tr>
<tr class="row-even"><td><p>1250</p></td>
<td><p>16</p></td>
<td><p>3.25 days</p></td>
</tr>
<tr class="row-odd"><td><p>12750</p></td>
<td><p>1</p></td>
<td><p>1.4 years</p></td>
</tr>
<tr class="row-even"><td><p>12750</p></td>
<td><p>4</p></td>
<td><p>4.4 months</p></td>
</tr>
<tr class="row-odd"><td><p>12750</p></td>
<td><p>16</p></td>
<td><p>1.1 months</p></td>
</tr>
</tbody>
</table>
</div>
<p>At the <a class="reference external" href="https://www.fz-juelich.de/inm/inm-7/EN/Home/home_node.html">INM-7</a>, were we have mainly developed this library, we have a
computational cluster that uses HTCondor. To overcome this limitation of
<code class="docutils literal notranslate"><span class="pre">julearn</span></code> and <a class="reference external" href="https://joblib.readthedocs.io/en/stable/">joblib</a>, we have created the <a class="reference external" href="https://github.com/juaml/joblib-htcondor">joblib-htcondor</a> backend. This
allows joblib to submit each task as a job in an HTCondor queue, allowing to
massively parallelize computation.</p>
<p>By simply calling <code class="docutils literal notranslate"><span class="pre">register_htcondor</span></code> from the <code class="docutils literal notranslate"><span class="pre">joblib_htcondor</span></code> package
and configuring the backend, we can easily parallelize the computations as in
the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">parallel_config</span>
<span class="kn">from</span> <span class="nn">joblib_htcondor</span> <span class="kn">import</span> <span class="n">register_htcondor</span>

<span class="n">register_htcondor</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>  <span class="c1"># Set logging level to INFO</span>

<span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">parallel_config</span><span class="p">(</span>
    <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;htcondor&quot;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_mem</span><span class="o">=</span><span class="s2">&quot;4Gb&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">X_types</span><span class="o">=</span><span class="n">X_types</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
        <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>This will submit each task to the HTCondor queue, and the computation will be
done in parallel. The <code class="docutils literal notranslate"><span class="pre">request_cpus</span></code> parameter specifies the number of CPUs
to request for each job, and the <code class="docutils literal notranslate"><span class="pre">request_mem</span></code> parameter specifies the
amount of memory to request.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">register_htcondor</span></code> function sets the logging level to
<code class="docutils literal notranslate"><span class="pre">&quot;INFO&quot;</span></code>, which means that you will see information regarding the HTCondor
backend. If you want to see less information, you can set the logging level to
<code class="docutils literal notranslate"><span class="pre">&quot;WARNING&quot;</span></code>. If you believe that there might be an issue with the backend,
you can set the logging level to <code class="docutils literal notranslate"><span class="pre">&quot;DEBUG&quot;</span></code> to see more information that
can be later shared with the developers.</p>
</div>
<p>Nevertheless, as it is, it will submit as many jobs as outer folds in the
cross-validation, and it will rarely work for large projects as we need to take
into account other factors.</p>
<section id="data-transfer">
<h3>Data Transfer<a class="headerlink" href="#data-transfer" title="Link to this heading">#</a></h3>
<p>When submitting jobs to a cluster, we need to take into account that the data
needs to be transferred between workers. The <a class="reference external" href="https://github.com/juaml/joblib-htcondor">joblib-htcondor</a> backend uses
filesystem-based data transfer, which means that the data will be stored in
a file that must be accessible by all the workers. The location of the shared
directory can be specified with the <code class="docutils literal notranslate"><span class="pre">shared_data_dir</span></code> parameter.</p>
<p>For example, at the INM-7, we can have a shared directory at
<code class="docutils literal notranslate"><span class="pre">/data/project/supercool_research</span></code>. Our example then becomes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">parallel_config</span>
<span class="kn">from</span> <span class="nn">joblib_htcondor</span> <span class="kn">import</span> <span class="n">register_htcondor</span>

<span class="n">register_htcondor</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>

<span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">parallel_config</span><span class="p">(</span>
    <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;htcondor&quot;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_mem</span><span class="o">=</span><span class="s2">&quot;4Gb&quot;</span><span class="p">,</span>
    <span class="n">shared_data_dir</span><span class="o">=</span><span class="s2">&quot;/data/project/supercool_research&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">X_types</span><span class="o">=</span><span class="n">X_types</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
        <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pool">
<h3>Pool<a class="headerlink" href="#pool" title="Link to this heading">#</a></h3>
<p>As in any computational cluster, most probably you will be required to submit
a job to a queue, which will then run the <a class="reference internal" href="../api/generated/julearn.run_cross_validation.html#julearn.run_cross_validation" title="julearn.run_cross_validation"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_cross_validation()</span></code></a>
function that will then submit more jobs to the queue. This is not a problem,
but it needs to be possible to submit jobs from within a job. Check with your
cluster’s admin team and ask for further instructions. Most probably you’ll
also need to specify to which <cite>pool</cite> the jobs will be submitted. This can be
done with the <code class="docutils literal notranslate"><span class="pre">pool</span></code> parameter. For us, this is <code class="docutils literal notranslate"><span class="pre">head2.htc.inm7.de</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">parallel_config</span>
<span class="kn">from</span> <span class="nn">joblib_htcondor</span> <span class="kn">import</span> <span class="n">register_htcondor</span>

<span class="n">register_htcondor</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>

<span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">parallel_config</span><span class="p">(</span>
    <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;htcondor&quot;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_mem</span><span class="o">=</span><span class="s2">&quot;4Gb&quot;</span><span class="p">,</span>
    <span class="n">shared_data_dir</span><span class="o">=</span><span class="s2">&quot;/data/project/supercool_research&quot;</span><span class="p">,</span>
    <span class="n">pool</span><span class="o">=</span><span class="s2">&quot;head2.htc.inm7.de&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">X_types</span><span class="o">=</span><span class="n">X_types</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
        <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="recursive-parallelization">
<h3>Recursive parallelization<a class="headerlink" href="#recursive-parallelization" title="Link to this heading">#</a></h3>
<p>Let’s say we have the following pipeline:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;svm&quot;</span><span class="p">,</span>
    <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;rbf&quot;</span><span class="p">,</span>
    <span class="n">C</span><span class="o">=</span><span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
    <span class="n">gamma</span><span class="o">=</span><span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This is indeed a pipeline with a hyperparameter search. A 5-fold Grid Search
approach will evaluate 49 different models, 5 times each. And this will happen
for every outer fold. So if we use <a class="reference external" href="https://github.com/juaml/joblib-htcondor">joblib-htcondor</a> as in the previous
example, each task could also benefit from parallelism, by submitting each
inner fold of each hyperparameter combination as a separate job. This is
called recursive parallelization and we can instruct the backend to allow this
by setting the <code class="docutils literal notranslate"><span class="pre">max_recursion_level</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">1</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">parallel_config</span>
<span class="kn">from</span> <span class="nn">joblib_htcondor</span> <span class="kn">import</span> <span class="n">register_htcondor</span>

<span class="n">register_htcondor</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>

<span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">parallel_config</span><span class="p">(</span>
    <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;htcondor&quot;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_mem</span><span class="o">=</span><span class="s2">&quot;4Gb&quot;</span><span class="p">,</span>
    <span class="n">shared_data_dir</span><span class="o">=</span><span class="s2">&quot;/data/project/supercool_research&quot;</span><span class="p">,</span>
    <span class="n">pool</span><span class="o">=</span><span class="s2">&quot;head2.htc.inm7.de&quot;</span><span class="p">,</span>
    <span class="n">max_recursion_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">X_types</span><span class="o">=</span><span class="n">X_types</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
        <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a class="reference external" href="https://scikit-learn.org/stable/">scikit-learn</a> parallelizes many algorithms internally by default. So if
you set the <code class="docutils literal notranslate"><span class="pre">max_recursion_level</span></code> to something different than 0, you
might end-up with thousands of thousands of jobs. Please READ THE WHOLE
DOCUMENTATION before using this parameter, as it will be explained in more
detail.</p>
</div>
<p>But beware! This will submit 245 (5 times 49) jobs for each outer fold. For a
5 times 5-fold CV, this means 6125 jobs. This can be a lot of jobs, but not
for HTCondor. It is though an issue with the data transfer. If each job requires
500 MB of data, this means 3.1 TB of data transfer, which requires 3.1 TB of
disk space in the shared directory.</p>
</section>
<section id="throttling">
<h3>Throttling<a class="headerlink" href="#throttling" title="Link to this heading">#</a></h3>
<p>Indeed, even if we queue all of the previous 6125 jobs at once, we are also
limited by the number of slots in the cluster. We can <em>throttle</em> the number of
jobs that are submitted at once by setting the <code class="docutils literal notranslate"><span class="pre">throttle</span></code> parameter. This
parameter specifies the number of jobs that can be either running or queued at
the same time, thus also limiting the number of files in the shared directory.</p>
<p><a class="reference external" href="https://github.com/juaml/joblib-htcondor">joblib-htcondor</a> will submit jobs until the throttle is reached, and then it
will wait until a job finishes to submit a new one. The complicated part is
that with recursive parallelization, the effect of throttling can be quite
complex. If you have a throttle of 100, and you have 5 outer folds, each with
5 inner folds, and each inner fold with 49 hyperparameter combinations, you
will have 6125 jobs. If you throttle at 100, you will have 100 jobs running at
the same time, but you will have 2525 jobs queued or running, since the
throttle is applied to the inner folds independently.</p>
<p>We can also set the throttle parameter by level, by specifying a list of
throttles. For example, to throttle at 25 for the outer folds and at 50 for
the inner folds, we can do the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">parallel_config</span>
<span class="kn">from</span> <span class="nn">joblib_htcondor</span> <span class="kn">import</span> <span class="n">register_htcondor</span>

<span class="n">register_htcondor</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>

<span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">parallel_config</span><span class="p">(</span>
    <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;htcondor&quot;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_mem</span><span class="o">=</span><span class="s2">&quot;4Gb&quot;</span><span class="p">,</span>
    <span class="n">shared_data_dir</span><span class="o">=</span><span class="s2">&quot;/data/project/supercool_research&quot;</span><span class="p">,</span>
    <span class="n">pool</span><span class="o">=</span><span class="s2">&quot;head2.htc.inm7.de&quot;</span><span class="p">,</span>
    <span class="n">max_recursion_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">throttle</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
<span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">X_types</span><span class="o">=</span><span class="n">X_types</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
        <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>This indeed will create a maximum of 25 jobs for the outer folds and 50 jobs
for the inner folds, resulting in 1275 jobs in total. If each job requires 500
MB of data, this means 637.5 GB of disk space in the shared directory.</p>
</section>
<section id="overhead">
<h3>Overhead<a class="headerlink" href="#overhead" title="Link to this heading">#</a></h3>
<p>The overhead of submitting jobs to a cluster is not negligible. Each job
submission requires some time, and the data transfer also requires some time.
This overhead can be quite significant, and it is important to take it into
account when parallelizing your code. The <a class="reference external" href="https://github.com/juaml/joblib-htcondor">joblib-htcondor</a> backend is
intended to be used for large computations, where the overhead is negligible
with respect to the computation.</p>
</section>
<section id="scikit-learn-parallelization">
<h3>Scikit-learn parallelization<a class="headerlink" href="#scikit-learn-parallelization" title="Link to this heading">#</a></h3>
<p>The rule is quite simple, if it has an <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code> parameter, it can be
parallelized using joblib. This is the case for most of the scikit-learn’s
algorithms. While the developers of scikit-learn are doing a great job and
currently working on documenting how this is done for each algorithm, this is
still not that evident.</p>
<p>Most importantly, the default is always <code class="docutils literal notranslate"><span class="pre">n_jobs=-1</span></code>. This means that it will
use joblib for everything. In combination with <a class="reference external" href="https://github.com/juaml/joblib-htcondor">joblib-htcondor</a>, this can
be a big issue. Thus, the recommendation is to always set the <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code>
parameter to <code class="docutils literal notranslate"><span class="pre">1</span></code> for every learning algorithm that you use, unless is an
ensemble in which every estimator takes hours to fit.</p>
<p>A clear example on when <em>NOT</em> to use <code class="docutils literal notranslate"><span class="pre">n_jobs=-1</span></code> is when using a
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html#sklearn.ensemble.RandomForestClassifier" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code></a>. If left as default,
this will queue one job for each decision tree, resulting in hundreds of
relatively small jobs which will take a lot of time to complete, given the
overhead.</p>
<p>The following is a non-exhaustive list of scikit-learn’s algorithms that might
make sense to set the <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">-1</span></code> or leave as default:</p>
<ul>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.StackingClassifier.html#sklearn.ensemble.StackingClassifier" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">StackingClassifier</span></code></a> and
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.StackingRegressor.html#sklearn.ensemble.StackingRegressor" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">StackingRegressor</span></code></a></p>
<p>This model will first fit the base estimators in parallel for the whole data.
Then it will fit and score the base estimators in parallel for each of the
internal CV folds, to generate the meta-features.</p>
</li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.VotingClassifier.html#sklearn.ensemble.VotingClassifier" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">VotingClassifier</span></code></a> and
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.VotingRegressor.html#sklearn.ensemble.VotingRegressor" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">VotingRegressor</span></code></a></p>
<p>Similar to the stacking models.</p>
</li>
<li><p>Hyperparameter searchers</p>
<p>Most of the hyperparameter searchers in scikit-learn will parallelize the
search for the best hyperparameters. Either at the internal CV level or at
both the hyperparameter search space and the internal CV level, depending
on the searcher.</p>
</li>
</ul>
</section>
<section id="visualizing-progress">
<h3>Visualizing Progress<a class="headerlink" href="#visualizing-progress" title="Link to this heading">#</a></h3>
<p>When submitting jobs to a cluster, it is important to know the progress of the
computation. The <a class="reference external" href="https://github.com/juaml/joblib-htcondor">joblib-htcondor</a> package has a text-based user interface
that allows to monitor the progress of the computation, an important feature
when submitting several recursive parallel jobs.</p>
<p>First, we need to set the <code class="docutils literal notranslate"><span class="pre">export_metadata</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code> in the
<code class="docutils literal notranslate"><span class="pre">parallel_config</span></code> context manager. This will create medatada files that
will be used by the UI.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">parallel_config</span>
<span class="kn">from</span> <span class="nn">joblib_htcondor</span> <span class="kn">import</span> <span class="n">register_htcondor</span>

<span class="n">register_htcondor</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>

<span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">parallel_config</span><span class="p">(</span>
    <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;htcondor&quot;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">request_mem</span><span class="o">=</span><span class="s2">&quot;4Gb&quot;</span><span class="p">,</span>
    <span class="n">shared_data_dir</span><span class="o">=</span><span class="s2">&quot;/data/project/supercool_research&quot;</span><span class="p">,</span>
    <span class="n">pool</span><span class="o">=</span><span class="s2">&quot;head2.htc.inm7.de&quot;</span><span class="p">,</span>
    <span class="n">max_recursion_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">throttle</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
    <span class="n">export_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">X_types</span><span class="o">=</span><span class="n">X_types</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
        <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Once the jobs are submitted and running, we will see something like this with
the <code class="docutils literal notranslate"><span class="pre">condor_q</span></code> command:</p>
<img alt="condor_q" src="../_images/condor_q.png" />
<p>The first row is the original job that is running <cite>run_cross_validation</cite>. The
rest are joblib-htcondor jobs.</p>
<p>Now this is difficult to understand, so we can use the <a class="reference external" href="https://github.com/juaml/joblib-htcondor">joblib-htcondor</a> UI,
pointing to the shared directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>joblib_htcondor.ui<span class="w"> </span>--path<span class="w"> </span>/data/project/supercool_research
</pre></div>
</div>
<p>While in the main window, we can press the <code class="docutils literal notranslate"><span class="pre">O</span></code> key to open a <em>root</em> file.
That is, the file that contains the metadata of the first batch of jobs that
triggered the rest of the jobs:</p>
<img alt="Open Menu" src="../_images/ui_open.png" />
<p>Once we press <code class="docutils literal notranslate"><span class="pre">ENTER</span></code>, we will see then see the following:</p>
<img alt="Main UI" src="../_images/ui_main.png" />
<p>The top row displays a summary per level of recursion. In this case, we have
two levels of recursion. The first level is the outer folds (5 times 5-fold)
and full final model fitting, and the second level is a Grid Search
(110 hyperparameter combinations, 5-fold CV). The throttle is set to 26 for
the outer fold and 60 for the inner folds.</p>
<p>On the bottom, we an see that it has been running for almost 4 days and
we are using 10% of the 1.3 Tb of shared disk space.</p>
<p>A more complex model might look like this:</p>
<img alt="Stacked UI" src="../_images/ui_stacked.png" />
<p>This is a stacked model with a hyperparameter search created as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the pipeline for the sepal features, by default will apply to &quot;sepal&quot;</span>
<span class="n">model_sepal</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;sepal&quot;</span><span class="p">)</span>
<span class="n">model_sepal</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;filter_columns&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;sepal&quot;</span><span class="p">)</span>
<span class="n">model_sepal</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">model_sepal</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># Create the pipeline for the petal features, by default will apply to &quot;petal&quot;</span>
<span class="n">model_petal</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;petal&quot;</span><span class="p">)</span>
<span class="n">model_petal</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;filter_columns&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;petal&quot;</span><span class="p">)</span>
<span class="n">model_petal</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>
<span class="n">model_petal</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;rf&quot;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Create the stacking model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;stacking&quot;</span><span class="p">,</span>
    <span class="n">estimators</span><span class="o">=</span><span class="p">[[(</span><span class="s2">&quot;model_sepal&quot;</span><span class="p">,</span> <span class="n">model_sepal</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;model_petal&quot;</span><span class="p">,</span> <span class="n">model_petal</span><span class="p">)]],</span>
    <span class="n">final_estimator</span><span class="o">=</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>As you can see, even the
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html#sklearn.linear_model.LogisticRegression" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogisticRegression</span></code></a> model has an
<code class="docutils literal notranslate"><span class="pre">n_jobs</span></code> parameter that must be set to <code class="docutils literal notranslate"><span class="pre">1</span></code>!</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../available_pipeline_steps.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">7. </span>Overview of available Pipeline Steps</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="CBPM.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">6.7. </span>Connectome-based Predictive Modeling (CBPM)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Authors of julearn
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">6.8. Parallelizing julearn with Joblib</a><ul>
<li><a class="reference internal" href="#massively-parallelizing-julearn-with-joblib-and-htcondor">Massively parallelizing <code class="docutils literal notranslate"><span class="pre">julearn</span></code> with Joblib and HTcondor</a><ul>
<li><a class="reference internal" href="#data-transfer">Data Transfer</a></li>
<li><a class="reference internal" href="#pool">Pool</a></li>
<li><a class="reference internal" href="#recursive-parallelization">Recursive parallelization</a></li>
<li><a class="reference internal" href="#throttling">Throttling</a></li>
<li><a class="reference internal" href="#overhead">Overhead</a></li>
<li><a class="reference internal" href="#scikit-learn-parallelization">Scikit-learn parallelization</a></li>
<li><a class="reference internal" href="#visualizing-progress">Visualizing Progress</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/custom.js?v=9868c0c7"></script>
    </body>
</html>